if(typeof(Prototype)=="undefined"){throw"Control.Rating requires Prototype to be loaded.";}if(typeof(Object.Event)=="undefined"){throw"Control.Rating requires Object.Event to be loaded.";}Control.Rating=Class.create({initialize:function(a,c){Control.Rating.instances.push(this);this.value=false;this.links=[];this.container=$(a);this.container.update("");this.options={min:1,max:5,rated:false,input:false,reverse:false,capture:true,multiple:false,classNames:{off:"rating_off",half:"rating_half",on:"rating_on",selected:"rating_selected"},updateUrl:false,updateParameterName:"value",updateOptions:{},afterChange:Prototype.emptyFunction};Object.extend(this.options,c||{});if(this.options.value){this.value=this.options.value;delete this.options.value;}if(this.options.input){this.options.input=$(this.options.input);this.options.input.observe("change",function(d){this.setValueFromInput(d);}.bind(this,this.options.input));this.setValueFromInput(this.options.input,true);}var b=$R(this.options.min,this.options.max);(this.options.reverse?$A(b).reverse():b).each(function(d){var e=this.buildLink(d);this.container.appendChild(e);this.links.push(e);}.bind(this));this.setValue(this.value||this.options.min-1,false,true);},buildLink:function(a){var b=$(document.createElement("a"));b.value=a;if(this.options.multiple||(!this.options.rated&&!this.options.multiple)){b.href="";b.onmouseover=this.mouseOver.bind(this,b);b.onmouseout=this.mouseOut.bind(this,b);b.onclick=this.click.bindAsEventListener(this,b);}else{b.style.cursor="default";b.observe("click",function(c){Event.stop(c);return false;}.bindAsEventListener(this));}b.addClassName(this.options.classNames.off);return b;},disable:function(){this.links.each(function(a){a.onmouseover=Prototype.emptyFunction;a.onmouseout=Prototype.emptyFunction;a.onclick=Prototype.emptyFunction;a.observe("click",function(b){Event.stop(b);return false;}.bindAsEventListener(this));a.style.cursor="default";}.bind(this));},setValueFromInput:function(a,b){this.setValue($F(a),true,b);},setValue:function(e,c,d){this.value=e;if(this.options.input){if(this.options.input.options){$A(this.options.input.options).each(function(g,a){if(g.value==this.value){this.options.input.options.selectedIndex=a;throw $break;}}.bind(this));}else{this.options.input.value=this.value;}}this.render(this.value,c);if(!d){if(this.options.updateUrl){var f={},b;f[this.options.updateParameterName]=this.value;b=new Ajax.Request(this.options.updateUrl,Object.extend(this.options.updateOptions,{parameters:f}));}this.notify("afterChange",this.value);}},render:function(b,a){(this.options.reverse?this.links.reverse():this.links).each(function(d,c){if(d.value<=Math.ceil(b)){d.className=this.options.classNames[d.value<=b?"on":"half"];if(this.options.rated||a){d.addClassName(this.options.classNames.selected);}}else{d.className=this.options.classNames.off;}}.bind(this));},mouseOver:function(a){this.render(a.value,true);},mouseOut:function(a){this.render(this.value);},click:function(b,a){this.options.rated=true;this.setValue((a.value?a.value:a),true);if(!this.options.multiple){this.disable();}if(this.options.capture){Event.stop(b);return false;}}});Object.extend(Control.Rating,{instances:[],findByElementId:function(a){return Control.Rating.instances.find(function(b){return(b.container.id&&b.container.id==a);});}});Object.Event.extend(Control.Rating);